<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Twilio Auth Token</title>

<style>
    body {
        background: #f5f5f7;
        font-family: Arial, Helvetica, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    .card {
        background: #fff;
        padding: 40px;
        border-radius: 18px;
        box-shadow: 0 8px 28px rgba(0,0,0,0.12);
        text-align: center;
        width: 380px;
    }

    h1 {
        font-size: 22px;
        color: #c40024;
        margin-bottom: 25px;
        font-weight: 600;
    }

    .token {
        font-size: 62px;
        letter-spacing: 8px;
        font-weight: bold;
        color: #222;
        margin-bottom: 20px;
        user-select: none;
    }

    .circle-container {
        position: relative;
        width: 140px;
        height: 140px;
        margin: auto;
    }

    svg {
        transform: rotate(-90deg);
    }

    .progress {
        transition: stroke-dashoffset 0.25s linear;
    }

    .timer-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 26px;
        color: #c40024;
        font-weight: bold;
    }

    .sms-area {
        margin-top: 28px;
    }

    .sms-area input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
        font-size: 16px;
    }

    .sms-area button {
        width: 100%;
        padding: 12px;
        background: #c40024;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    .sms-area button:hover {
        background: #a0001e;
    }
</style>

</head>
<body>

<div class="card">
    <h1>Twilio Auth Token</h1>

    <div class="token" id="token">------</div>

    <div class="circle-container">
        <svg width="140" height="140">
            <circle cx="70" cy="70" r="60" stroke="#eee" stroke-width="12" fill="none"/>
            <circle id="progressCircle" cx="70" cy="70" r="60" 
                stroke="#c40024" stroke-width="12" fill="none"
                stroke-dasharray="377" stroke-dashoffset="377"
                class="progress"/>
        </svg>
        <div class="timer-text" id="timerText">30</div>
    </div>

    <div class="sms-area">
        <input id="telefone" placeholder="+5511999999999">
        <button onclick="enviarCodigo()">Enviar código por SMS</button>
        #####
        <button onclick="pushNotify()">Push Notify</button>
    </div>
</div>
  


<script>
    const API_URL = "server.php";
    let totalTime = 30;
    let timeLeft = totalTime;

    function animateCircle() {
        const circle = document.getElementById("progressCircle");
        const offset = 377 - (377 * (timeLeft / totalTime));
        circle.style.strokeDashoffset = offset;
        document.getElementById("timerText").textContent = timeLeft;
    }

    async function buscarToken() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            document.getElementById("token").textContent = data.token || "------";
        } catch (e) {
            document.getElementById("token").textContent = "Error";
        }
    }

    setInterval(() => {
        if (timeLeft === totalTime) {
            buscarToken();
        }

        animateCircle();

        timeLeft--;
        if (timeLeft < 0) timeLeft = totalTime;
    }, 1000);

    function enviarCodigo() {
        const numero = document.getElementById('telefone').value;

        fetch('send_sms.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'phone=' + encodeURIComponent(numero)
        })
        .then(r => r.json())
        .then(res => {
            alert("Código enviado!");
        })
        .catch(() => alert("Erro ao enviar código."));
    }
</script>

</body>
</html>
